---
title: è‹å·å¤§å­¦æ ¡å›­ç½‘è®¤è¯è„šæœ¬
summary: è‹å·å¤§å­¦æ ¡å›­ç½‘è®¤è¯è„šæœ¬,åŠå…¬å®¤è·¯ç”±å™¨åˆ†å‘ç½‘ç»œã€‚
tags:
  - Web
date: 2025-08-10T13:17:09Z
categories:
  - Work
draft: false
isCJKLanguage: true
showAuthor: true
authors:
  - è‘›ä¸–æ°
---
> åœ¨ [è‹å¤§æ ¡å›­ç½‘ã®å°å¦™æ‹› - å››å¶è‰ã®åšå®¢](http://www.wzcwzc.cool/post/32834fab.html) æä¾›çš„è„šæœ¬åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹è°ƒæ•´ï¼Œè¯¦ç»†çš„åŸç†å’Œå®ç°å¯ç‚¹å‡» ğŸ”— è¿›ä¸€æ­¥äº†è§£

## ä¸€ã€èµ·å› 

ä¼—æ‰€å‘¨çŸ¥ï¼Œé«˜æ ¡çš„æ ¡å›­ç½‘éƒ½éœ€è¦è¿›è¡Œè®¤è¯æ‰èƒ½è®¿é—®ç½‘ç»œï¼Œæ¯æ¬¡ç½‘ç»œæ‰çº¿å†è®¤è¯å°±æ¯”è¾ƒéº»çƒ¦ã€‚äºæ˜¯åœ¨ç½‘ä¸Šçœ‹çœ‹æœ‰æ²¡æœ‰é«˜æ‰‹ç ”ç©¶è¿‡ç›¸å…³çš„å†…å®¹ã€‚æœç„¶æœ‰å‰äººæŒ‡è·¯ï¼Œä½†æ˜¯åšä¸»å†™çš„è„šæœ¬æ˜¯ç½‘å…³è®¾å¤‡ç›´è¿æ ¡å›­ç½‘ï¼Œä¸æˆ‘è¦å®ç°çš„æƒ…å†µä¸åŒã€‚

åŠå…¬å®¤å’Œæœºæˆ¿çš„æœåŠ¡å™¨ç½‘å…³çš„ ip åœ°å€æ˜¯ä¸Šçº§è·¯ç”±å™¨çš„ WANå£åœ°å€ï¼Œè€Œéæœ¬æœº ip åœ°å€ã€‚åªæœ‰ç½‘å…³ ipåœ°å€å’Œè´¦æˆ·å¯†ç ç»‘å®šæ‰èƒ½æ­£ç¡®è®¿é—®å¤–ç½‘ï¼Œäºæ˜¯åœ¨åŸæ¥çš„è„šæœ¬åŸºç¡€ä¸Šç¨ä½œä¿®æ”¹ã€‚

## äºŒã€éœ€æ±‚å®ç°

åŠå…¬å®¤æœ‰å°ç¾¤æ™– NASï¼Œæœºæˆ¿æœåŠ¡å™¨ä¹Ÿæ˜¯ Linuxï¼Œå°† Python è„šæœ¬æŒ‚è½½åˆ°åå°æ¯å°æ—¶è¿è¡Œä¸€æ¬¡ã€‚ç®€å•è¯´ä¸€ä¸‹åŸç†ï¼šæ ¡å›­ç½‘é¡µé¢ç™»å½•è´¦å·è®¤è¯ä¼šå‘é€é“¾æ¥è¯·æ±‚ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨è„šæœ¬æ¨¡æ‹Ÿç½‘é¡µè¯·æ±‚å®ç°ç½‘å…³è®¤è¯ã€‚

å…³é”®æ˜¯å¦‚ä½•è·å–ä¸Šçº§è·¯ç”±å™¨ WAN å£çš„åœ°å€ã€‚è¦å®ç°å’Œè·¯ç”±å™¨é€šä¿¡è·å– WAN å£åœ°å€æ¯”è¾ƒéº»çƒ¦ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·è·å¾—å…¬ç½‘ ip åœ°å€ä½œä¸ºç½‘å…³åœ°å€ã€‚ä¸è¿‡è¿˜å¥½æ ¡å›­ç½‘è®¤è¯é¡µé¢ä¼šå‘Šè¯‰ä½ çš„ç½‘å…³åœ°å€æ˜¯å¤šå°‘ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ requests æ¨¡å—æŠ“å–ç½‘é¡µå†…å®¹è§£æç½‘å…³ ip ã€‚

## ä¸‰ã€ä¹Ÿå¯ä»¥ç›´æ¥çœ‹è¿™

å°†è„šæœ¬å†…å®¹å­˜ä¸º auth_web.pyï¼Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œ python ./auth_web.py ï¼ˆå·²ç»é…ç½®å¥½ Python ç¯å¢ƒï¼‰ä¸è¦å¿˜è®°ä¿®æ”¹è®¤è¯ ID ï¼ŒPASSWORD å’Œ ISPï¼ˆæ ¡å›­ç½‘ã€ä¸­å›½ç§»åŠ¨ã€ä¸­å›½è”é€šã€ä¸­å›½ç”µä¿¡ï¼‰

è„šæœ¬å†…å®¹ï¼š

```bash
import os
import urllib.request
import json
import requests
import re

def get_v4ip_from_webpage():
    url = "http://a.suda.edu.cn"
    try:
        # å‘é€HTTP GETè¯·æ±‚
        response = requests.get(url, timeout=5)
        response.raise_for_status()  # æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ

        # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾v4ipçš„å€¼
        match = re.search(r"v46ip\s*=\s*'([\d\.]+)'", response.text)
        if match:
            return match.group(1)
        else:
            print("æœªåœ¨ç½‘é¡µä¸­æ‰¾åˆ°v4ipä¿¡æ¯")
            return None
    except requests.exceptions.RequestException as e:
        print(f"è¯·æ±‚ç½‘é¡µæ—¶å‡ºé”™: {e}")
        return None

def check_network():
    # Pingç™¾åº¦ï¼Œå‘é€2ä¸ªåŒ…ï¼Œè¶…æ—¶2ç§’
    response = os.system("ping -c 2 -W 2 www.baidu.com > /dev/null 2>&1")
    return response == 0  # è¿”å›Trueå¦‚æœèƒ½pingé€š

def campus_auth():
    # ç”¨æˆ·é…ç½®
    user_name = "id"  # æ›¿æ¢ä¸ºä½ çš„è´¦å·
    user_password = "password"  # æ›¿æ¢ä¸ºä½ çš„å¯†ç 
    ISP = ""  # è¿è¥å•†ï¼šæ ¡å›­ç½‘ï¼ˆå¯é€‰ @zgyd ä¸­å›½ç§»åŠ¨ @cucc è”é€šã€@ctc ç”µä¿¡ï¼‰

    # ç›´æ¥ä½¿ç”¨å›ºå®šIP 10.9.1.3ï¼Œä¸æ£€æµ‹æœ¬æœºIP
    login_url = f"http://10.9.1.3:801/eportal/?c=Portal&a=login&callback=dr1003&login_method=1&user_account=%2C0%2C{user_name}{ISP}&user_password={user_password}&wlan_user_ip={target_ip}&wlan_user_ipv6=&wlan_user_mac=000000000000&wlan_ac_ip=&wlan_ac_name=&jsVersion=3.3.3"

    # å¤‡ç”¨æœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰
    backup_url = login_url.replace("10.9.1.3", "10.9.1.4")  # æ›¿æ¢ä¸ºå¤‡ç”¨IP

    print("å°è¯•ç™»å½•ï¼ŒURL:", login_url)

    try:
        response = urllib.request.urlopen(login_url)
    except urllib.error.URLError:
        print("ä¸»æœåŠ¡å™¨è¿æ¥å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æœåŠ¡å™¨...")
        try:
            response = urllib.request.urlopen(backup_url)
        except urllib.error.URLError:
            print("ç½‘ç»œè¿æ¥å¤±è´¥ï¼è¯·æ£€æŸ¥ç½‘ç»œã€‚")
            return False

    # è§£æè¿”å›ç»“æœ
    str_resp = response.read().decode('utf-8')
    str_json = str_resp[7:-1]  # å»é™¤å›è°ƒå‡½æ•°åï¼ˆdr1003(...)ï¼‰
    data = json.loads(str_json)

    # åˆ¤æ–­ç™»å½•ç»“æœ
    if data.get('result') == "1" and data.get('msg') == "\u8ba4\u8bc1\u6210\u529f":  # "è®¤è¯æˆåŠŸ"
        print("âœ… è®¤è¯æˆåŠŸï¼")
        return True
    elif data.get('ret_code') == 2:
        print("âš ï¸ å·²ç»ç™»å½•ï¼")
        return True
    elif data.get('ret_code') == 1:
        if data.get('msg') == "QXV0aGVudGljYXRpb24gZmFpbA==":  # "Authentication fail" (Base64)
            print("âŒ è¿è¥å•†é”™è¯¯ï¼")
        elif data.get('msg') == "bGRhcCBhdXRoIGVycm9y":  # "ldap auth error" (Base64)
            print("âŒ å¯†ç é”™è¯¯ï¼")
        elif data.get('msg') == "dXNlcmlkIGVycm9yMQ==":  # "userid error1" (Base64)
            print("âŒ ç”¨æˆ·åé”™è¯¯ï¼")
        else:
            print("âŒ ç™»å½•å¤±è´¥ï¼ŒæœªçŸ¥é”™è¯¯:", data)
    else:
        print("âŒ æœªçŸ¥å“åº”:", data)
    return False

if __name__ == "__main__":
    if not check_network():
        print("ç½‘ç»œä¸é€šï¼Œå°è¯•æ ¡å›­ç½‘è®¤è¯...")
        # è·å–v4ipå¹¶èµ‹å€¼ç»™target_ip
        target_ip = get_v4ip_from_webpage()
        if target_ip:
            print(f"æˆåŠŸè·å–v4ip: {target_ip}")
        else:
            print("æœªèƒ½è·å–v4ip")
        campus_auth()
    else:
        print("ç½‘ç»œæ­£å¸¸ï¼Œæ— éœ€è®¤è¯")

```

